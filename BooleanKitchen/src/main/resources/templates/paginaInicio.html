<!DOCTYPE html>
<html lang="es" xmls:th="http://thymeleaf.org">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css" />
        <link rel="stylesheet" type="text/css" th:href="@{/css/stRecetasYNoticias.css}">
        <link rel="stylesheet" type="text/css" th:href="@{/css/stNav.css}">
        <link rel="stylesheet" type="text/css" th:href="@{/css/stFooter.css}">
        <link rel="stylesheet" type="text/css" th:href="@{/css/stModal.css}">
        <link rel="stylesheet" type="text/css" th:href="@{/css/stTable.css}">
        <link rel="stylesheet" type="text/css" th:href="@{/css/stBtnEliminar.css}">
        <link rel="stylesheet" type="text/css" th:href="@{/css/stBtnEditar.css}">
        <link rel="stylesheet" type="text/css" th:href="@{/css/stColores_fuentes.css}">
        <script text="text/javascript" th:src="@{/js/jsNav.js}" defer></script>
        <link rel="stylesheet" type="text/css" th:href="@{/css/stDialog.css}">
        <script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js" defer></script>
        <script text="text/javascript" th:src="@{/js/jsModalAdd.js}"></script>
        <title>Bienvenido</title>


    </head>

    <body>

        <div th:replace="plantillas/nav :: nav"></div>

        <main class="main">
            <!-- Noticias -->

            <div class="news">
                <div class="carousel-news">
                    <div class="container-news" th:if="${noticias != null and !noticias.empty}">
                        <div class="swiper">
                            <div class="swiper-wrapper">
                                <div class="swiper-slide" th:each="noticia : ${noticias}">
                                    <a href="#" style="text-decoration: none;">
                                        <img th:src="@{/assets/__${noticia.image}__}" alt="Imagen de una noticia">
                                        <div class="news-details">
                                            <h2 th:text="${noticia.tittle}"></h2>
                                            <p th:text="${noticia.resume}"></p>
                                            <p th:text="${noticia.author}"></p>
                                        </div>
                                    </a>
                                </div>
                            </div>
                            <div class="swiper-pagination"></div>

                            <div class="swiper-button-prev"></div>
                            <div class="swiper-button-next"></div>
                        </div>
                    </div>
                    <div th:if="${noticias == null || noticias.empty}" style="text-align: center;">
                        No se encontraron noticias
                    </div>
                </div>
            </div>
            <div class="container-category">
                
                <h2>Que quieres cocinar?</h2>
                <div class="container-category-items" th:if="${categorias != null and !categorias.empty}">
                    <div class="item" th:each="cat : ${categorias}">
                        <img th:src="@{/imgCat/__${cat.image}__}" alt="Imagen de una categoria"/>
                        <a href="#" style="text-decoration: none">
                            <div style="text-align: center;" class="category" th:text="${cat.name}"></div>
                        </a>
                    </div>
                </div>
                <div class="container-category-items" th:if="${categorias == null || categorias.empty}" style="text-align: center;">
                    No se encontraron categorias
                </div>
            </div>

            <div class="recipe">
                <h1 style="text-align: center;">⭐Top 10 mejores recetas⭐</h1>
                <div class="container-recipe" th:if="${mejoresRecetas != null and !mejoresRecetas.empty}">
                    <div class="card" th:each="receta : ${mejoresRecetas}">
                        <a th:href="@{/c_receta/verDetallesDeReceta(id=${receta.identificador})}" style="text-decoration: none;">
                            <div class="card-image">
                                <img th:src="@{/assets/__${receta.image}__}" alt="Imagen de una receta" />
                            </div>
                            <div class="category" th:text="${receta.category.name}"> </div>
                            <div class="heading">
                                <span th:text="${receta.name}"></span>
                                <div class="author"> Por <span class="name" th:text="${receta.user.userName}"></span></div>
                            </div>
                        </a>
                    </div>
                </div>
                <div th:if="${mejoresRecetas == null || mejoresRecetas.empty}" style="text-align: center;">
                    No se encontrarron recetas
                </div>
            </div>

        </main>

        <footer th:replace="plantillas/footer :: footer"></footer>


        <dialog th:replace="Receta/NuevaReceta :: dialog"></dialog>


<script>
    function closeModal() {
        var modal = document.getElementById('modal-add-recipe');
        document.body.style.overflow = 'visible'; //Desbloque el scroll
        modal.close();
    }
</script>



        <script>
            var tSearch = document.querySelector(".searchbar-input");
            tSearch.addEventListener("keypress", function (event) {
                if (event.key === "Enter") {
                    event.preventDefault();
                    buscar();
                }
            });

            var searchIcon = document.getElementById('searchIcon');
            // Agrega un evento de clic al elemento SVG
            searchIcon.addEventListener('click', function () {
                buscar();
            });

            document.addEventListener("DOMContentLoaded", function () {
                // Inicializa Swiper
                var mySwiper = new Swiper(".swiper", {
                    // Configura la dirección del carrusel (horizontal por defecto)
                    direction: "horizontal",
                    loop: true,
                    // Habilita la paginación
                    pagination: {
                        el: ".swiper-pagination",
                        clickable: true,
                    },
                    // Habilita la navegación con botones previo/siguiente
                    navigation: {
                        nextEl: ".swiper-button-next",
                        prevEl: ".swiper-button-prev",
                    },
                });

                setInterval(function () {
                    mySwiper.slideNext();
                }, 7000);
            });

            function buscar() {
                var form = document.getElementById('buscarRecetaForm');
                form.submit();
            }
        </script>


        <!-- Enviar formulario creo que ya no se ocupa-->
        <script>
            function enviarFormulario() {
                event.preventDefault();
                //        Utensilios
                var tablaUtensilios = document.getElementById("table-utensilios");
                var filasUtensilios = tablaUtensilios.getElementsByTagName("tr");
                var datosTablaUtensilios = [];
                for (var i = 1; i < filasUtensilios.length; i++) {
                    var celdas = filasUtensilios[i].getElementsByTagName("td");
                    datosTablaUtensilios.push(celdas[0].innerText);
                }
                var tablaUtensiliosData = document.createElement("input");
                tablaUtensiliosData.setAttribute("type", "hidden");
                tablaUtensiliosData.setAttribute("name", "datosTablaUtensilios");
                tablaUtensiliosData.setAttribute("value", JSON.stringify(datosTablaUtensilios));
                document.getElementById("recipeForm").appendChild(tablaUtensiliosData);

                //        Ingredientes
                var tablaIngredientes = document.getElementById("table-ingredients");
                var filasIngredientes = tablaIngredientes.getElementsByTagName("tr");
                var datosTablaIngredientes = [];

                for (var i = 1; i < filasIngredientes.length; i++) {
                    var celdas = filasIngredientes[i].getElementsByTagName("td");
                    datosTablaIngredientes.push(celdas[0].innerText);
                }

                var tablaIngredientesData = document.createElement("input");
                tablaIngredientesData.setAttribute("type", "hidden");
                tablaIngredientesData.setAttribute("name", "datosTablaIngredientes");
                tablaIngredientesData.setAttribute("value", JSON.stringify(datosTablaIngredientes));
                // Agregar el campo oculto al formulario
                document.getElementById("recipeForm").appendChild(tablaIngredientesData);




//                //        Pasos 
//                var tablaPasos = document.getElementById("table-pasos");
//                var filasPasos = tablaPasos.getElementsByTagName("tr");
//                var descripcionPasos = [];
//                var imagenPasos = [];
//
//                for (var i = 1; i < filasPasos.length; i++) {
//                    var celdas = filasPasos[i].getElementsByTagName("td");
//                    var nombrePaso = celdas[0].innerText;
//                    var imagen = celdas[1].querySelector("img");
//
//                    // Verificar si hay una imagen dentro de la celda
//                    if (imagen) {
//                        var imagenSrc = imagen.getAttribute("src");
//                        descripcionPasos.push(nombrePaso);
//                        imagenPasos.push(imagenSrc);
//                    } else {
//                        var imagenSrc = "/assets/no_img.png";
//                        descripcionPasos.push(nombrePaso);
//                        imagenPasos.push(imagenSrc);
//                    }
//                }
//
//                // Crear un campo oculto para enviar la lista de descripciones de pasos
//                var descripcionPasosData = document.createElement("input");
//                descripcionPasosData.setAttribute("type", "hidden");
//                descripcionPasosData.setAttribute("name", "descripcionPasos");
//                descripcionPasosData.setAttribute("value", JSON.stringify(descripcionPasos));
//                document.getElementById("recipeForm").appendChild(descripcionPasosData);
//
//                // Crear un campo oculto para enviar la lista de imágenes de pasos
//                var imagenPasosData = document.createElement("input");
//                imagenPasosData.setAttribute("type", "hidden");
//                imagenPasosData.setAttribute("name", "imagenPasos");
//                imagenPasosData.setAttribute("value", JSON.stringify(imagenPasos));
//                document.getElementById("recipeForm").appendChild(imagenPasosData);

                document.getElementById("recipeForm").submit();
            }
        </script>

        <!-- Imagen -->
        <script>
            function deleteImage(id) {
                event.preventDefault();
                if (document.getElementById(id).value !== '') {
                    document.getElementById(id).value = '';
                    var imageContainer = document.getElementById('imageContainer-' + id);
                    imageContainer.innerHTML = '<img src="/assets/uploadimg.jpg" alt="Imagen">';

                    // document.getElementById('deleteButton').disabled = true;
                } else {
                    alert('Por favor selecciona una imagen.');
                }
            }


            document.getElementById('file').addEventListener('change', function (event) {
                var file = event.target.files[0];
                var imageType = /^image\//;

                if (!file || !imageType.test(file.type)) {
                    document.getElementById("file").value = '';
                    alert('Por favor selecciona una imagen válida.');
                    return;
                }

                var reader = new FileReader();

                reader.onload = function (event) {
                    var imageContainer = document.getElementById('imageContainer-file');
                    imageContainer.innerHTML = '<img src="' + event.target.result + '" alt="Imagen">';
                    document.getElementById('deleteButton').disabled = false;
                };

                reader.readAsDataURL(file);
            });

            document.getElementById('file2').addEventListener('change', function (event) {
                var file = event.target.files[0];
                var imageType = /^image\//;

                if (!file || !imageType.test(file.type)) {
                    document.getElementById("file2").value = '';
                    alert('Por favor selecciona una imagen válida.');
                    return;
                }

                var reader = new FileReader();

                reader.onload = function (event) {
                    var imageContainer = document.getElementById('imageContainer-file2');
                    imageContainer.innerHTML = '<img src="' + event.target.result + '" alt="Imagen">';
                    document.getElementById('deleteButton').disabled = false;
                };

                reader.readAsDataURL(file);
            });

            document.getElementById('file3').addEventListener('change', function (event) {
                var file = event.target.files[0];
                var imageType = /^image\//;

                if (!file || !imageType.test(file.type)) {
                    document.getElementById("file3").value = '';
                    alert('Por favor selecciona una imagen válida.');
                    return;
                }

                var reader = new FileReader();

                reader.onload = function (event) {
                    var imageContainer = document.getElementById('imageContainer-file3');
                    imageContainer.innerHTML = '<img src="' + event.target.result + '" alt="Imagen">';
                    document.getElementById('deleteButton').disabled = false;
                };

                reader.readAsDataURL(file);
            });
        </script>

        <script text="text/javascript" th:src="@{/js/jsValidacionAgregarReceta.js}" defer></script>
    </body>

</html>